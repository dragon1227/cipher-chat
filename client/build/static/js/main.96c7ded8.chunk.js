(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{135:function(e,t,a){},139:function(e,t,a){e.exports=a.p+"static/media/profile.cae08926.jpg"},144:function(e,t,a){e.exports=a(310)},149:function(e,t,a){},150:function(e,t,a){},194:function(e,t){},196:function(e,t){},231:function(e,t){},232:function(e,t){},274:function(e,t,a){},275:function(e,t,a){},299:function(e,t){},302:function(e,t,a){},303:function(e,t,a){},304:function(e,t,a){},310:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(137),u=a.n(c),o=(a(149),a(150),function(){return r.a.createElement("footer",{className:"container"},r.a.createElement("small",null,"CipherChat | ",r.a.createElement("a",{href:"https://github.com/Dwyte/CipherChat"},"About")))}),s=a(4),l=a.n(s),i=a(10),m=a(6),p=a(39),f=a.n(p),h={get:f.a.get,post:f.a.post,put:f.a.put,delete:f.a.delete},b="/api/users",v=function(){var e=Object(i.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.get(b);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),g=function(){var e=Object(i.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.post(b,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(i.a)(l.a.mark(function e(t,a){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.put("".concat(b,"/").concat(t),a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),E=function(){var e=Object(i.a)(l.a.mark(function e(t){var a,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.get("".concat(b,"/").concat(t));case 2:return a=e.sent,n=a.data,e.abrupt("return",Boolean(n));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(i.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.post("".concat(b,"/auth/"),t));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=Object(i.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=localStorage.getItem("userToken"),a={headers:{"x-auth-token":t}},e.abrupt("return",h.get("".concat(b,"/auth"),a));case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),j=a(21),w=a.n(j),O=w.a.SHA256,S=function(e){var t=e.history,a=Object(n.useState)(""),c=Object(m.a)(a,2),u=c[0],o=c[1],s=Object(n.useState)(""),p=Object(m.a)(s,2),f=p[0],h=p[1],b=function(){var e=Object(i.a)(l.a.mark(function e(a){var n,r,c,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.next=3,E(u);case 3:if(e.sent){e.next=6;break}return e.abrupt("return",alert("User with the username not found."));case 6:return n=O(u+f).toString(),r=O(n+f).toString(),localStorage.setItem("pvk_phrase",r),e.prev=9,e.next=12,y({auth:n});case 12:c=e.sent,o=c.data,localStorage.setItem("userToken",o),alert("Account authenticated!"),t.push("/chat"),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(9),console.log(e.t0),localStorage.clear();case 23:case"end":return e.stop()}},e,null,[[9,19]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"container"},r.a.createElement("form",{onSubmit:b},r.a.createElement("input",{className:"mb",type:"text",placeholder:"Pseudoname",value:u,onChange:function(e){var t=e.target;return o(t.value)},pattern:".{2,}",required:!0,title:"2 characters or more"}),r.a.createElement("input",{className:"mb",type:"password",placeholder:"Secret Password",value:f,onChange:function(e){var t=e.target;return h(t.value)},pattern:".{8,}",required:!0,title:"must be atleast 8 characters"}),r.a.createElement("input",{className:"btn-dark",type:"submit",value:"Login"}),r.a.createElement("a",{href:"/register"},"Don't have an account yet?")))},x=a(17),N=a.n(x),C=w.a.SHA256,K=function(e){var t=e.history,a=Object(n.useState)(""),c=Object(m.a)(a,2),u=c[0],o=c[1],s=Object(n.useState)(""),p=Object(m.a)(s,2),f=p[0],h=p[1],b=function(){var e=Object(i.a)(l.a.mark(function e(a){var n,r,c,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.next=3,E(u);case 3:if(!e.sent){e.next=6;break}return e.abrupt("return",alert("User with the username already exists"));case 6:return n=C(u+f).toString(),r=C(n+f).toString(),c=N.a.generateRSAKey(r,1024),o=N.a.publicKeyString(c),e.prev=10,e.next=13,g({username:u,auth:n,publicKey:o});case 13:alert("Account has been created."),t.push("/login"),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),console.log(e.t0);case 20:case"end":return e.stop()}},e,null,[[10,17]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"container"},r.a.createElement("form",{onSubmit:b},r.a.createElement("input",{className:"mb",type:"text",placeholder:"Pseudoname",value:u,onChange:function(e){var t=e.target;return o(t.value)},pattern:".{2,}",required:!0,title:"2 characters or more"}),r.a.createElement("input",{className:"mb",type:"password",placeholder:"Secret Password",value:f,onChange:function(e){var t=e.target;return h(t.value)},pattern:".{8,}",required:!0,title:"must be atleast 8 characters"}),r.a.createElement("input",{className:"btn-dark",type:"submit",value:"Register"}),r.a.createElement("a",{href:"/login"},"Already have an account?")))},A=a(23),D=a(143),I=a(142),H=(a(274),a(275),function(e){var t=e.userKeys,a=e.isSecret,n=e.username,c=e.name,u=e.message,o=e.timestamp,s=(c=a?N.a.decrypt(c,t.pvk).plaintext:c)===n?"float-right max-width":"",l=c===n?"float-right text-align-right":"",i=c===n?"You":c;return r.a.createElement("div",{className:s},r.a.createElement("div",{id:"bubble-container",className:l},r.a.createElement("b",null,i)," ",r.a.createElement("br",null),r.a.createElement("div",{id:"message-bubble"},a?N.a.decrypt(u,t.pvk).plaintext:u)," ",r.a.createElement("br",null),r.a.createElement("small",{id:"timestamp"},function(){a&&(o=N.a.decrypt(o,t.pvk).plaintext);var e=new Date(o),n=e.getMonth(),r=e.getDate(),c=e.getFullYear(),u=e.getHours(),s=e.getMinutes();return"".concat(n,"/").concat(r,"/").concat(c," - ").concat(u,":").concat(s)}())))}),B=a(138),F=function(e){var t=e.sendMessage,a=Object(n.useState)(""),c=Object(m.a)(a,2),u=c[0],o=c[1],s=function(e){e.preventDefault(),""!==u&&(t(u),o(""))};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"message-form"},r.a.createElement("form",{onSubmit:s},r.a.createElement("input",{value:u,onChange:function(e){var t=e.target;o(t.value)},placeholder:"Type a message...",type:"text",required:!0}))),r.a.createElement("div",{className:"message-submit"},r.a.createElement("button",{onClick:s},r.a.createElement("i",{className:"fas fa-paper-plane"}))))},U=a.n(B)()(),_=function(e){var t=e.user,a=e.match,c=e.userKeys,u=Object(n.useState)([]),o=Object(m.a)(u,2),s=o[0],l=o[1],i=a.params.channel,p="global"!==i,f=p?{channel:i,pbkHash:Object(j.SHA256)(c.pbk).toString()}:{channel:i};Object(n.useEffect)(function(){return l([]),U.connect(),U.emit("get-chats",f),function(){U.disconnect()}},[i,c]),U.on("return-chats",function(e){h(e)}),U.on("new-message",function(e){h([].concat(Object(I.a)(s),[e]))});var h=function(e){l(e),d()},b=function(e){var a=t.username,n=(new Date).toString(),r=localStorage.getItem("chatmate_pbk"),u=v({name:a,message:e,timestamp:n},c.pbk);U.emit("send-secret-msg-self",u);var o=v({name:a,message:e,timestamp:n},r);U.emit("send-secret-msg",o)},v=function(e,t){for(var a in e)e[a]=N.a.encrypt(e[a],t).cipher;return e.pbkHash=Object(j.SHA256)(t).toString(),e.channel=i,e},g=function(e){var a={name:t.username,channel:i,message:e,timestamp:new Date};U.emit("send-message",a)},d=function(){var e=document.getElementById("chatbox");e.scrollTop=e.scrollHeight};return r.a.createElement("div",{className:"grid-container chatbox-container"},r.a.createElement("div",{id:"chatbox"},0===s.length?r.a.createElement("div",{className:"chat-notif"},"No messages yet. Say hello!"):s.map(function(e){return r.a.createElement(H,Object.assign({key:s.indexOf(e),username:t.username,userKeys:c,isSecret:p},e))})),r.a.createElement(F,{sendMessage:function(e){p?b(e):g(e)}}))},q=w.a.MD5,M=function(e){var t=e.user,a=e.currUser,n=e.history,c=e.setChannel;return r.a.createElement("div",{className:"container-item mb"},r.a.createElement("b",null,t.username),r.a.createElement("button",{onClick:function(){var e=[t.publicKey,a.publicKey].sort(),r=q(e.join()).toString();localStorage.setItem("chatmate_pbk",t.publicKey),c(r),n.push("/chat/ch/"+r)}}," ",r.a.createElement("i",{className:"fas fa-comment"})))},T=(a(302),function(e){var t=e.user,a=e.history,c=e.setChannel,u=Object(n.useState)([]),o=Object(m.a)(u,2),s=o[0],p=o[1],f=Object(n.useState)(""),h=Object(m.a)(f,2),b=h[0],g=h[1];Object(n.useEffect)(function(){!function(){var e=Object(i.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v();case 2:t=e.sent,a=t.data,p(a);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()()},[]);var d=s.filter(function(e){return e.username.match(new RegExp(b+".*","i"))});return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"list mb"},d.map(function(e){return r.a.createElement(M,{key:s.indexOf(e),user:e,currUser:t,history:a,setChannel:c})})),r.a.createElement("input",{value:b,onChange:function(e){var t=e.target;return g(t.value)},placeholder:"Search for someone to chat..."}))}),P=(a(303),a(139)),R=a.n(P),L=function(){return r.a.createElement("div",{id:"display-pic"},r.a.createElement("img",{alt:"anon",src:R.a,width:"42"}))},J=function(e){var t=e.username;return r.a.createElement("div",{id:"display-name"},r.a.createElement("b",null,t||"Loading..."))},W=function(e){var t=e.bio,a=e.onSave,c=Object(n.useState)(!1),u=Object(m.a)(c,2),o=u[0],s=u[1],l=Object(n.useState)(""),i=Object(m.a)(l,2),p=i[0],f=i[1],h=function(){return s(!o)};return Object(n.useEffect)(function(){f(t)},[t]),r.a.createElement("div",{id:"display-bio"},o?r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{maxLength:"50",value:p,onChange:function(e){var t=e.target;return f(t.value)}}),r.a.createElement("i",{onClick:function(e){if(t===p)return h();a(p),h()},className:"fas fa-save"})):r.a.createElement(r.a.Fragment,null,r.a.createElement("small",null,t||"bio"),r.a.createElement("i",{onClick:h,className:"fas fa-edit"})))},Y=function(e){var t=e.user,a=e.onUpdateBio;return r.a.createElement("div",{className:"container grid-container"},r.a.createElement(L,null),r.a.createElement(J,{username:t.username}),r.a.createElement(W,{onSave:a,bio:t.bio}),r.a.createElement("div",{onClick:function(){localStorage.clear(),window.location="/"},id:"logout"},r.a.createElement("button",null,r.a.createElement("i",{className:"fas fa-sign-out-alt"}))))},G=(a(135),function(e){var t=e.fa,a=e.label,n=e.className,c=e.handleClick;return r.a.createElement("div",null,r.a.createElement("button",{onClick:c,className:n},r.a.createElement("i",{className:t})," ",a))}),$=function(e){var t=e.history,a=e.location,n=e.setChannel;return r.a.createElement("div",{className:"container-item nav mb"},r.a.createElement("div",{className:"nav-grid"},r.a.createElement(G,{fa:"fas fa-search",label:"",className:"/chat/ch/global"!==a.pathname?"active":"",handleClick:function(){return t.push("/chat/search")}}),r.a.createElement(G,{fa:"fas fa-globe",label:"Global",className:"/chat/ch/global"===a.pathname?"active":"",handleClick:function(){t.push("/chat/ch/global"),n("global")}})))},z=(a(304),function(e){var t=e.history,a=e.location,c=Object(n.useState)({}),u=Object(m.a)(c,2),o=u[0],s=u[1],p=Object(n.useState)("global"),f=Object(m.a)(p,2),h=f[0],b=f[1],v=Object(n.useState)({}),g=Object(m.a)(v,2),E=g[0],y=g[1];Object(n.useEffect)(function(){var e=function(){var e=Object(i.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k();case 2:t=e.sent,a=t.data,s(a);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();y(j()),e()},[]);var j=function(){console.log("get keys");var e=localStorage.getItem("pvk_phrase"),t=N.a.generateRSAKey(e,1024);return{pvk:t,pbk:N.a.publicKeyString(t)}},w=function(){var e=Object(i.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=Object(D.a)({},o)).bio=t,e.prev=2,e.next=5,d(o._id,a);case 5:s(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log(e.t0);case 11:case"end":return e.stop()}},e,null,[[2,8]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y,{onUpdateBio:w,history:t,user:o}),r.a.createElement("div",{className:"container chat"},r.a.createElement($,{history:t,location:a,setChannel:b}),r.a.createElement(A.d,null,r.a.createElement(A.b,{path:"/chat/ch/:channel",render:function(e){return r.a.createElement(_,Object.assign({},e,{user:o,channel:h,userKeys:E}))}}),r.a.createElement(A.b,{path:"/chat/list",render:function(e){return r.a.createElement(T,Object.assign({},e,{user:o,setChannel:b}))}}),r.a.createElement(A.a,{from:"/chat",to:"/chat/list"}))))});var Q=function(){return r.a.createElement("div",{className:"app"},r.a.createElement(A.d,null,r.a.createElement(A.b,{path:"/chat",component:z}),r.a.createElement(A.b,{path:"/login",component:S}),r.a.createElement(A.b,{path:"/register",component:K}),function(){var e=localStorage.getItem("pvk_phrase")&&localStorage.getItem("userToken");return Boolean(e)}()?r.a.createElement(A.a,{from:"/",to:"/chat"}):"",r.a.createElement(A.a,{from:"/",to:"/login"})),r.a.createElement(o,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(309);var V=a(50);u.a.render(r.a.createElement(V.a,null,r.a.createElement(Q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[144,1,2]]]);
//# sourceMappingURL=main.96c7ded8.chunk.js.map