(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{139:function(e,t,a){},142:function(e,t,a){e.exports=a.p+"static/media/profile.cae08926.jpg"},146:function(e,t,a){e.exports=a(324)},151:function(e,t,a){},152:function(e,t,a){},196:function(e,t){},198:function(e,t){},233:function(e,t){},234:function(e,t){},276:function(e,t,a){},277:function(e,t,a){},315:function(e,t){},318:function(e,t,a){},319:function(e,t,a){},320:function(e,t,a){},324:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(76),u=a.n(c),s=(a(151),a(152),function(){return r.a.createElement("footer",{className:"container"},r.a.createElement("small",null,"CipherChat | ",r.a.createElement("a",{href:"https://github.com/Dwyte/CipherChat"},"Source Code")," ",r.a.createElement("br",null)))}),o=a(4),i=a.n(o),l=a(7),m=a(5),p=a(39),f=a.n(p),h={get:f.a.get,post:f.a.post,put:f.a.put,delete:f.a.delete},v=(Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_SERVICE_API||"http://localhost:4200/api")+"/users",d=function(){var e=Object(l.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.get(v);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),b=function(){var e=Object(l.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.post(v,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(l.a)(i.a.mark(function e(t,a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.put("".concat(v,"/").concat(t),a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),E=function(){var e=Object(l.a)(i.a.mark(function e(t){var a,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.get("".concat(v,"/").concat(t));case 2:return a=e.sent,n=a.data,e.abrupt("return",Boolean(n));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(l.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.post("".concat(v,"/auth/"),t));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=Object(l.a)(i.a.mark(function e(){var t,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=localStorage.getItem("userToken"),a={headers:{"x-auth-token":t}},e.abrupt("return",h.get("".concat(v,"/auth"),a));case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),S=a(21),j=a.n(S),k=j.a.SHA256,x=function(e){var t=e.history,a=Object(n.useState)(""),c=Object(m.a)(a,2),u=c[0],s=c[1],o=Object(n.useState)(""),p=Object(m.a)(o,2),f=p[0],h=p[1],v=function(){var e=Object(l.a)(i.a.mark(function e(a){var n,r,c,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.next=3,E(u);case 3:if(e.sent){e.next=6;break}return e.abrupt("return",alert("User with the username not found."));case 6:return n=k(u+f).toString(),r=k(n+f).toString(),localStorage.setItem("pvk_phrase",r),e.prev=9,e.next=12,y({auth:n});case 12:c=e.sent,s=c.data,localStorage.setItem("userToken",s),alert("Account authenticated!"),t.push("/chat"),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(9),alert("Authentication Failed: Wrong Credentials"),localStorage.clear();case 23:case"end":return e.stop()}},e,null,[[9,19]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"container"},r.a.createElement("form",{onSubmit:v},r.a.createElement("input",{className:"mb",type:"text",placeholder:"Pseudoname",value:u,onChange:function(e){var t=e.target;return s(t.value)},pattern:".{2,12}",maxLength:"12",required:!0,title:"2 characters or more"}),r.a.createElement("input",{className:"mb",type:"password",placeholder:"Secret Password",value:f,onChange:function(e){var t=e.target;return h(t.value)},pattern:".{8,}",required:!0,title:"must be atleast 8 characters"}),r.a.createElement("input",{className:"btn-dark",type:"submit",value:"Login"}),r.a.createElement("a",{href:"/register"},"Don't have an account yet?")))},w=a(11),C=a.n(w),N=j.a.SHA256,P=function(e){var t=e.history,a=Object(n.useState)(""),c=Object(m.a)(a,2),u=c[0],s=c[1],o=Object(n.useState)(""),p=Object(m.a)(o,2),f=p[0],h=p[1],v=function(){var e=Object(l.a)(i.a.mark(function e(a){var n,r,c,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.next=3,E(u);case 3:if(!e.sent){e.next=6;break}return e.abrupt("return",alert("User with the username already exists"));case 6:return n=N(u+f).toString(),r=N(n+f).toString(),c=C.a.generateRSAKey(r,1024),s=C.a.publicKeyString(c),e.prev=10,e.next=13,b({username:u,auth:n,publicKey:s});case 13:alert("Account has been created."),t.push("/login"),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),alert("Error: ",e.t0);case 20:case"end":return e.stop()}},e,null,[[10,17]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"container"},r.a.createElement("form",{onSubmit:v},r.a.createElement("input",{className:"mb",type:"text",placeholder:"Pseudoname",value:u,onChange:function(e){var t=e.target;return s(t.value)},pattern:".{2,12}",maxLength:"12",required:!0,title:"2 characters or more"}),r.a.createElement("input",{className:"mb",type:"password",placeholder:"Secret Password",value:f,onChange:function(e){var t=e.target;return h(t.value)},pattern:".{8,}",required:!0,title:"must be atleast 8 characters"}),r.a.createElement("input",{className:"btn-dark",type:"submit",value:"Register"}),r.a.createElement("a",{href:"/login"},"Already have an account?")))},A=a(23),_=a(145),I=a(52),D=(a(276),a(277),function(e){var t=e.username,a=e.msgObj,c=e.isSecret,u=e.userKeys,s=e.prevMsg,o=e.decryptMsg,i=Object(n.useState)(!1),l=Object(m.a)(i,2),p=l[0],f=l[1],h=a.name,v=a.message,d=a.timestamp,b=a.decrypted;c&&(b||(h=C.a.decrypt(h,u.pvk).plaintext)===t&&o(a));var g=h===t?"float-right max-width":"",E=h===t?"float-right text-align-right":"",y=h===t?"You":h,O=function(){if(!s)return!1;var e=s.name,t=s.decrypted;return(c?t?e:C.a.decrypt(e,u.pvk).plaintext:e)===h};return r.a.createElement("div",{className:g},r.a.createElement("div",{id:"bubble-container",className:E},function(){var e=r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{id:"displayName"},y));return O()?void 0:e}(),r.a.createElement("div",{id:"message-bubble",className:"pointer ".concat(O()?"mt-sm":""),onClick:c?b?function(){return f(!p)}:function(){c&&o(a)}:function(){return f(!p)},onMouseLeave:function(){return setTimeout(function(){return f(!1)},1250)}},c&&!b?r.a.createElement("i",{className:"fas fa-lock"}):v),r.a.createElement("br",null),p?function(){if(c&&!b)return r.a.createElement("div",{id:"timestamp"},"Decrypt");var e=new Date(d),t=e.getMonth(),a=e.getDay(),n=e.getDate(),u=e.getHours(),s=u<10?"0".concat(u):u,o=e.getMinutes(),i=o<10?"0".concat(o):o,l=["January","February","March","April","May","June","July","August","September","October","November","December"][t].slice(0,3),m=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][a].slice(0,3),p="".concat(l," ").concat(n,", ").concat(m," - ").concat(s,":").concat(i);return r.a.createElement("div",{id:"timestamp"},r.a.createElement("i",{className:"fas fa-caret-right"}),p)}():null))}),K=a(51),L=a.n(K),T=function(e){var t=e.sendMessage,a=e.isSecret,c=Object(n.useState)(""),u=Object(m.a)(c,2),s=u[0],o=u[1],i=function(e){e.preventDefault(),t(s),o("")},l=a?"Private Channel - Encrypted - 10msgs max":"Global Channel - Plain Text - 100msgs max";return r.a.createElement(r.a.Fragment,null,r.a.createElement(L.a,{place:"top",effect:"solid"}),r.a.createElement("div",{className:"message-form"},r.a.createElement("form",{onSubmit:i},r.a.createElement("input",{value:s,onChange:function(e){var t=e.target;o(t.value)},minLength:"1",maxLength:"500","data-tip":l,placeholder:"Start Chatting...",type:"text",required:!0}))),r.a.createElement("div",{className:"message-submit"},r.a.createElement("button",{onClick:i},r.a.createElement("i",{className:"fas fa-paper-plane"}))))},M=a(141),R=a.n(M)()(Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_SOCKET_ENDPOINT||"http://localhost:4200"),U=function(e){var t=e.user,a=e.match,c=e.userKeys,u=Object(n.useState)([]),s=Object(m.a)(u,2),o=s[0],i=s[1],l=a.params.channel,p="global"!==l,f=p?10:100,h=p?Object(S.SHA256)(c.pbk).toString():void 0;Object(n.useEffect)(function(){return i([]),R.connect(),R.emit("get-chats",l,f,h),function(){R.disconnect()}},[l,c]),R.on("return-chats",function(e){d(e)}),R.on("new-message",function(e){if(!p&&e.channel===l){var t=[].concat(Object(I.a)(o),[e]).splice(-f);d(t)}}),R.on("new-secret-message",function(e){if(p&&e.channel===l){var t=[].concat(Object(I.a)(o),[e]).splice(-f);d(t)}}),R.on("message-invalid",function(e){alert(e)});var v=function(e){var t=Object(I.a)(o),a=t.find(function(t){return t===e});a.name=C.a.decrypt(e.name,c.pvk).plaintext,a.timestamp=C.a.decrypt(e.timestamp,c.pvk).plaintext,a.message=C.a.decrypt(e.message,c.pvk).plaintext,a.decrypted=!0,i(t)},d=function(e){i(e),y()},b=function(e){var a=t.username,n=(new Date).toString(),r=localStorage.getItem("chatmate_pbk"),u=g({name:a,message:e,timestamp:n},c.pbk);if(R.emit("send-secret-msg-self",u),c.pbk!==r){var s=g({name:a,message:e,timestamp:n},r);R.emit("send-secret-msg",s)}},g=function(e,t){for(var a in e)e[a]=C.a.encrypt(e[a],t).cipher;return e.pbkHash=Object(S.SHA256)(t).toString(),e.channel=l,e},E=function(e){var a={name:t.username,channel:l,message:e,timestamp:new Date};R.emit("send-message",a)},y=function(){var e=document.getElementById("chatbox");e.scrollTop=e.scrollHeight};return r.a.createElement("div",{className:"grid-container chatbox-container"},r.a.createElement("div",{id:"chatbox"},function(){var e=null;return 0===o.length?r.a.createElement("div",{className:"chat-notif"},"No messages yet. Say hello!"):o.map(function(a){var n=r.a.createElement(D,{key:o.indexOf(a),username:t.username,userKeys:c,isSecret:p,msgObj:a,prevMsg:e,decryptMsg:v});return e=a,n})}()),r.a.createElement(T,{sendMessage:function(e){p?b(e):E(e)},isSecret:p}))},B=(Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_SERVICE_API||"http://localhost:4200/api")+"/chats",F=function(){var e=Object(l.a)(i.a.mark(function e(t){var a,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=localStorage.getItem("userToken"),n={headers:{"x-auth-token":a}},e.next=4,h.put(B,t,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),H=j.a.MD5,q=j.a.SHA256,J=function(e){var t=e.user,a=e.currUser,c=e.history,u=e.setChannel,s=e.setPrivChannel,o=Object(n.useState)(0),p=Object(m.a)(o,2),f=p[0],h=p[1];Object(n.useEffect)(function(){!function(){var e=Object(l.a)(i.a.mark(function e(){var a,n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={channel:v(),pbkHash:q(t.publicKey).toString()},e.next=3,F(a);case 3:n=e.sent,r=n.data,h(r.length);case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()()},[]);var v=function(){var e=[t.publicKey,a.publicKey].sort();return H(e.join()).toString()};return r.a.createElement("div",{className:"container-item mb"},r.a.createElement(L.a,{place:"left",effect:"solid"}),r.a.createElement("div",null,r.a.createElement("b",{className:"badge"},f)," ",r.a.createElement("b",null,t.username," ")),r.a.createElement("div",null,r.a.createElement("i",{className:"fas fa-info-circle","data-tip":t.username===a.username?"You":t.bio})," ",r.a.createElement("i",{className:"fas fa-comment",onClick:function(){var e=v();localStorage.setItem("chatmate_pbk",t.publicKey),s(t.username),u(e),c.push("/chat/ch/"+e)}})))},V=(a(318),function(e){var t=e.user,a=e.history,c=e.setChannel,u=e.setPrivChannel,s=Object(n.useState)([]),o=Object(m.a)(s,2),p=o[0],f=o[1],h=Object(n.useState)(""),v=Object(m.a)(h,2),b=v[0],g=v[1];Object(n.useEffect)(function(){!function(){var e=Object(l.a)(i.a.mark(function e(){var t,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d();case 2:t=e.sent,a=t.data,f(a);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()()},[]);var E=p.filter(function(e){return e.username.match(new RegExp(b+".*","i"))});return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"list mb"},E.map(function(e){return r.a.createElement(J,{key:p.indexOf(e),user:e,currUser:t,history:a,setChannel:c,setPrivChannel:u})})),r.a.createElement("input",{value:b,onChange:function(e){var t=e.target;return g(t.value)},placeholder:"Search for someone to chat..."}))}),W=(a(319),a(142)),G=a.n(W),Y=function(){return r.a.createElement("div",{id:"display-pic"},r.a.createElement("img",{alt:"anon",src:G.a,width:"42"}))},$=function(e){var t=e.username;return r.a.createElement("div",{id:"display-name"},r.a.createElement("b",null,t||"Loading..."))},z=function(e){var t=e.bio,a=e.onSave,c=Object(n.useState)(!1),u=Object(m.a)(c,2),s=u[0],o=u[1],i=Object(n.useState)(""),l=Object(m.a)(i,2),p=l[0],f=l[1],h=function(){return o(!s)};return Object(n.useEffect)(function(){f(t)},[t]),r.a.createElement("div",{id:"display-bio"},s?r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{maxLength:"25",value:p,onChange:function(e){var t=e.target;return f(t.value)}}),r.a.createElement("i",{onClick:function(e){if(t===p)return h();a(p),h()},className:"fas fa-save"})):r.a.createElement(r.a.Fragment,null,r.a.createElement("small",null,t||"bio"),r.a.createElement("i",{onClick:h,className:"fas fa-edit"})))},Q=function(e){var t=e.user,a=e.onUpdateBio;return r.a.createElement("div",{className:"container grid-container"},r.a.createElement(Y,null),r.a.createElement($,{username:t.username}),r.a.createElement(z,{onSave:a,bio:t.bio}),r.a.createElement("div",{onClick:function(){localStorage.clear(),window.location="/"},id:"logout"},r.a.createElement("button",{className:"pointer"},r.a.createElement("i",{className:"fas fa-sign-out-alt"}))))},X=(a(139),function(e){var t=e.fa,a=e.label,n=e.className,c=e.handleClick;return r.a.createElement("div",null,r.a.createElement("button",{onClick:c,className:n},r.a.createElement("i",{className:t})," ",a))}),Z=function(e){var t=e.history,a=e.location,n=e.setChannel,c=e.privChannel,u=e.setPrivChannel;return r.a.createElement("div",{className:"container-item nav mb"},r.a.createElement("div",{className:"nav-grid"},r.a.createElement(X,{fa:"fas fa-envelope",label:c,className:"/chat/ch/global"!==a.pathname?"active":"",handleClick:function(){u(""),t.push("/chat/search")}}),r.a.createElement(X,{fa:"fas fa-globe",label:"Global",className:"/chat/ch/global"===a.pathname?"active":"",handleClick:function(){t.push("/chat/ch/global"),u(""),n("global")}})))},ee=(a(320),function(e){var t=e.history,a=e.location,c=Object(n.useState)({}),u=Object(m.a)(c,2),s=u[0],o=u[1],p=Object(n.useState)("global"),f=Object(m.a)(p,2),h=f[0],v=f[1],d=Object(n.useState)({}),b=Object(m.a)(d,2),E=b[0],y=b[1],S=Object(n.useState)(""),j=Object(m.a)(S,2),k=j[0],x=j[1];Object(n.useEffect)(function(){var e=function(){var e=Object(l.a)(i.a.mark(function e(){var t,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O();case 2:t=e.sent,a=t.data,o(a);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();y(w()),e()},[]);var w=function(){console.log("get keys");var e=localStorage.getItem("pvk_phrase"),t=C.a.generateRSAKey(e,1024);return{pvk:t,pbk:C.a.publicKeyString(t)}},N=function(){var e=Object(l.a)(i.a.mark(function e(t){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=Object(_.a)({},s)).bio=t,e.prev=2,e.next=5,g(s._id,a);case 5:o(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log(e.t0);case 11:case"end":return e.stop()}},e,null,[[2,8]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(Q,{onUpdateBio:N,history:t,user:s}),r.a.createElement("div",{className:"container chat"},r.a.createElement(Z,{history:t,location:a,setChannel:v,privChannel:k,setPrivChannel:x}),r.a.createElement(A.d,null,r.a.createElement(A.b,{path:"/chat/ch/:channel",render:function(e){return r.a.createElement(U,Object.assign({},e,{user:s,channel:h,userKeys:E}))}}),r.a.createElement(A.b,{path:"/chat/list",render:function(e){return r.a.createElement(V,Object.assign({},e,{user:s,setChannel:v,setPrivChannel:x}))}}),r.a.createElement(A.a,{from:"/chat",to:"/chat/list"}))))});var te=function(){return r.a.createElement("div",{className:"app"},r.a.createElement(A.d,null,r.a.createElement(A.b,{path:"/chat",component:ee}),r.a.createElement(A.b,{path:"/login",component:x}),r.a.createElement(A.b,{path:"/register",component:P}),function(){var e=localStorage.getItem("pvk_phrase")&&localStorage.getItem("userToken");return Boolean(e)}()?r.a.createElement(A.a,{from:"/",to:"/chat"}):"",r.a.createElement(A.a,{from:"/",to:"/login"})),r.a.createElement(s,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(323);var ae=a(50);u.a.render(r.a.createElement(ae.a,null,r.a.createElement(te,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[146,1,2]]]);
//# sourceMappingURL=main.28a65aa0.chunk.js.map