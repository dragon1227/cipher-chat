(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{136:function(e,t,a){},140:function(e,t,a){e.exports=a.p+"static/media/profile.cae08926.jpg"},144:function(e,t,a){e.exports=a(310)},149:function(e,t,a){},150:function(e,t,a){},194:function(e,t){},196:function(e,t){},231:function(e,t){},232:function(e,t){},274:function(e,t,a){},275:function(e,t,a){},299:function(e,t){},302:function(e,t,a){},303:function(e,t,a){},304:function(e,t,a){},310:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(138),s=a.n(c),u=(a(149),a(150),function(){return r.a.createElement("footer",{className:"container"},r.a.createElement("small",null,"CipherChat | ",r.a.createElement("a",{href:"https://github.com/Dwyte/CipherChat"},"About")))}),o=a(4),l=a.n(o),i=a(10),m=a(5),p=a(39),f=a.n(p),h={get:f.a.get,post:f.a.post,put:f.a.put,delete:f.a.delete},b="/api/users",v=function(){var e=Object(i.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.get(b);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),g=function(){var e=Object(i.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.post(b,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(i.a)(l.a.mark(function e(t,a){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.put("".concat(b,"/").concat(t),a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),E=function(){var e=Object(i.a)(l.a.mark(function e(t){var a,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.get("".concat(b,"/").concat(t));case 2:return a=e.sent,n=a.data,e.abrupt("return",Boolean(n));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(i.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.post("".concat(b,"/auth/"),t));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(i.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=localStorage.getItem("userToken"),a={headers:{"x-auth-token":t}},e.abrupt("return",h.get("".concat(b,"/auth"),a));case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),O=a(21),k=a.n(O),w=k.a.SHA256,S=function(e){var t=e.history,a=Object(n.useState)(""),c=Object(m.a)(a,2),s=c[0],u=c[1],o=Object(n.useState)(""),p=Object(m.a)(o,2),f=p[0],h=p[1],b=function(){var e=Object(i.a)(l.a.mark(function e(a){var n,r,c,u;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.next=3,E(s);case 3:if(e.sent){e.next=6;break}return e.abrupt("return",alert("User with the username not found."));case 6:return n=w(s+f).toString(),r=w(n+f).toString(),localStorage.setItem("pvk_phrase",r),e.prev=9,e.next=12,y({auth:n});case 12:c=e.sent,u=c.data,localStorage.setItem("userToken",u),alert("Account authenticated!"),t.push("/chat"),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(9),console.log(e.t0),localStorage.clear();case 23:case"end":return e.stop()}},e,null,[[9,19]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"container"},r.a.createElement("form",{onSubmit:b},r.a.createElement("input",{className:"mb",type:"text",placeholder:"Pseudoname",value:s,onChange:function(e){var t=e.target;return u(t.value)},pattern:".{2,}",required:!0,title:"2 characters or more"}),r.a.createElement("input",{className:"mb",type:"password",placeholder:"Secret Password",value:f,onChange:function(e){var t=e.target;return h(t.value)},pattern:".{8,}",required:!0,title:"must be atleast 8 characters"}),r.a.createElement("input",{className:"btn-dark",type:"submit",value:"Login"}),r.a.createElement("a",{href:"/register"},"Don't have an account yet?")))},x=a(12),N=a.n(x),C=k.a.SHA256,K=function(e){var t=e.history,a=Object(n.useState)(""),c=Object(m.a)(a,2),s=c[0],u=c[1],o=Object(n.useState)(""),p=Object(m.a)(o,2),f=p[0],h=p[1],b=function(){var e=Object(i.a)(l.a.mark(function e(a){var n,r,c,u;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.next=3,E(s);case 3:if(!e.sent){e.next=6;break}return e.abrupt("return",alert("User with the username already exists"));case 6:return n=C(s+f).toString(),r=C(n+f).toString(),c=N.a.generateRSAKey(r,1024),u=N.a.publicKeyString(c),e.prev=10,e.next=13,g({username:s,auth:n,publicKey:u});case 13:alert("Account has been created."),t.push("/login"),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),console.log(e.t0);case 20:case"end":return e.stop()}},e,null,[[10,17]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"container"},r.a.createElement("form",{onSubmit:b},r.a.createElement("input",{className:"mb",type:"text",placeholder:"Pseudoname",value:s,onChange:function(e){var t=e.target;return u(t.value)},pattern:".{2,}",required:!0,title:"2 characters or more"}),r.a.createElement("input",{className:"mb",type:"password",placeholder:"Secret Password",value:f,onChange:function(e){var t=e.target;return h(t.value)},pattern:".{8,}",required:!0,title:"must be atleast 8 characters"}),r.a.createElement("input",{className:"btn-dark",type:"submit",value:"Register"}),r.a.createElement("a",{href:"/login"},"Already have an account?")))},D=a(23),A=a(143),I=a(51),M=(a(274),a(275),function(e){var t=e.username,a=e.msgObj,c=e.isSecret,s=e.userKeys,u=e.decryptMsg,o=Object(n.useState)(!1),l=Object(m.a)(o,2),i=l[0],p=l[1],f=a.name,h=a.message,b=a.timestamp;c&&(i||(f=N.a.decrypt(f,s.pvk).plaintext));var v=f===t?"float-right max-width":"",g=f===t?"float-right text-align-right":"",d=f===t?"You":f,E=function(){p(!0),u(a)};return r.a.createElement("div",{className:v},r.a.createElement("div",{id:"bubble-container",className:g},r.a.createElement("b",null,d)," ",r.a.createElement("br",null),r.a.createElement("div",{id:"message-bubble",className:"pointer"},c&&!i?r.a.createElement("i",{className:"fas fa-lock",onClick:E}):h)," ",r.a.createElement("br",null),r.a.createElement("small",{id:"timestamp"},function(){if(c&&!i)return"Decrypt the Message";var e=new Date(b),t=e.getMonth(),a=e.getDate(),n=e.getFullYear(),r=e.getHours(),s=e.getMinutes();return"".concat(t,"/").concat(a,"/").concat(n," - ").concat(r,":").concat(s)}())))}),B=function(e){var t=e.sendMessage,a=Object(n.useState)(""),c=Object(m.a)(a,2),s=c[0],u=c[1],o=function(e){e.preventDefault(),""!==s&&(t(s),u(""))};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"message-form"},r.a.createElement("form",{onSubmit:o},r.a.createElement("input",{value:s,onChange:function(e){var t=e.target;u(t.value)},placeholder:"Type a message...",type:"text",required:!0}))),r.a.createElement("div",{className:"message-submit"},r.a.createElement("button",{onClick:o},r.a.createElement("i",{className:"fas fa-paper-plane"}))))},H=a(139),F=a.n(H)()(),U=function(e){var t=e.user,a=e.match,c=e.userKeys,s=Object(n.useState)([]),u=Object(m.a)(s,2),o=u[0],l=u[1],i=a.params.channel,p="global"!==i,f=p?8:10,h=p?Object(O.SHA256)(c.pbk).toString():void 0;Object(n.useEffect)(function(){return l([]),F.connect(),F.emit("get-chats",i,f,h),function(){F.disconnect()}},[i,c]),F.on("return-chats",function(e){v(e)}),F.on("new-message",function(e){if(!p){var t=[].concat(Object(I.a)(o),[e]).splice(-f);v(t)}}),F.on("new-secret-message",function(e){if(p){var t=[].concat(Object(I.a)(o),[e]).splice(-f);v(t)}});var b=function(e){var t=Object(I.a)(o),a=t.find(function(t){return t===e});a.name=N.a.decrypt(e.name,c.pvk).plaintext,a.timestamp=N.a.decrypt(e.timestamp,c.pvk).plaintext,a.message=N.a.decrypt(e.message,c.pvk).plaintext,l(t)},v=function(e){l(e),y()},g=function(e){var a=t.username,n=(new Date).toString(),r=localStorage.getItem("chatmate_pbk"),s=d({name:a,message:e,timestamp:n},c.pbk);F.emit("send-secret-msg-self",s);var u=d({name:a,message:e,timestamp:n},r);F.emit("send-secret-msg",u)},d=function(e,t){for(var a in e)e[a]=N.a.encrypt(e[a],t).cipher;return e.pbkHash=Object(O.SHA256)(t).toString(),e.channel=i,e},E=function(e){var a={name:t.username,channel:i,message:e,timestamp:new Date};F.emit("send-message",a)},y=function(){var e=document.getElementById("chatbox");e.scrollTop=e.scrollHeight};return r.a.createElement("div",{className:"grid-container chatbox-container"},r.a.createElement("div",{id:"chatbox"},0===o.length?r.a.createElement("div",{className:"chat-notif"},"No messages yet. Say hello!"):o.map(function(e){return r.a.createElement(M,{key:o.indexOf(e),username:t.username,userKeys:c,isSecret:p,msgObj:e,decryptMsg:b})})),r.a.createElement(B,{sendMessage:function(e){p?g(e):E(e)}}))},_=k.a.MD5,q=function(e){var t=e.user,a=e.currUser,n=e.history,c=e.setChannel;return r.a.createElement("div",{className:"container-item mb"},r.a.createElement("b",null,t.username),r.a.createElement("button",{onClick:function(){var e=[t.publicKey,a.publicKey].sort(),r=_(e.join()).toString();localStorage.setItem("chatmate_pbk",t.publicKey),c(r),n.push("/chat/ch/"+r)}}," ",r.a.createElement("i",{className:"fas fa-comment"})))},T=(a(302),function(e){var t=e.user,a=e.history,c=e.setChannel,s=Object(n.useState)([]),u=Object(m.a)(s,2),o=u[0],p=u[1],f=Object(n.useState)(""),h=Object(m.a)(f,2),b=h[0],g=h[1];Object(n.useEffect)(function(){!function(){var e=Object(i.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v();case 2:t=e.sent,a=t.data,p(a);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()()},[]);var d=o.filter(function(e){return e.username.match(new RegExp(b+".*","i"))});return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"list mb"},d.map(function(e){return r.a.createElement(q,{key:o.indexOf(e),user:e,currUser:t,history:a,setChannel:c})})),r.a.createElement("input",{value:b,onChange:function(e){var t=e.target;return g(t.value)},placeholder:"Search for someone to chat..."}))}),P=(a(303),a(140)),R=a.n(P),L=function(){return r.a.createElement("div",{id:"display-pic"},r.a.createElement("img",{alt:"anon",src:R.a,width:"42"}))},J=function(e){var t=e.username;return r.a.createElement("div",{id:"display-name"},r.a.createElement("b",null,t||"Loading..."))},W=function(e){var t=e.bio,a=e.onSave,c=Object(n.useState)(!1),s=Object(m.a)(c,2),u=s[0],o=s[1],l=Object(n.useState)(""),i=Object(m.a)(l,2),p=i[0],f=i[1],h=function(){return o(!u)};return Object(n.useEffect)(function(){f(t)},[t]),r.a.createElement("div",{id:"display-bio"},u?r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{maxLength:"50",value:p,onChange:function(e){var t=e.target;return f(t.value)}}),r.a.createElement("i",{onClick:function(e){if(t===p)return h();a(p),h()},className:"fas fa-save"})):r.a.createElement(r.a.Fragment,null,r.a.createElement("small",null,t||"bio"),r.a.createElement("i",{onClick:h,className:"fas fa-edit"})))},Y=function(e){var t=e.user,a=e.onUpdateBio;return r.a.createElement("div",{className:"container grid-container"},r.a.createElement(L,null),r.a.createElement(J,{username:t.username}),r.a.createElement(W,{onSave:a,bio:t.bio}),r.a.createElement("div",{onClick:function(){localStorage.clear(),window.location="/"},id:"logout"},r.a.createElement("button",{className:"pointer"},r.a.createElement("i",{className:"fas fa-sign-out-alt"}))))},G=(a(136),function(e){var t=e.fa,a=e.label,n=e.className,c=e.handleClick;return r.a.createElement("div",null,r.a.createElement("button",{onClick:c,className:n},r.a.createElement("i",{className:t})," ",a))}),$=function(e){var t=e.history,a=e.location,n=e.setChannel;return r.a.createElement("div",{className:"container-item nav mb"},r.a.createElement("div",{className:"nav-grid"},r.a.createElement(G,{fa:"fas fa-search",label:"",className:"/chat/ch/global"!==a.pathname?"active":"",handleClick:function(){return t.push("/chat/search")}}),r.a.createElement(G,{fa:"fas fa-globe",label:"Global",className:"/chat/ch/global"===a.pathname?"active":"",handleClick:function(){t.push("/chat/ch/global"),n("global")}})))},z=(a(304),function(e){var t=e.history,a=e.location,c=Object(n.useState)({}),s=Object(m.a)(c,2),u=s[0],o=s[1],p=Object(n.useState)("global"),f=Object(m.a)(p,2),h=f[0],b=f[1],v=Object(n.useState)({}),g=Object(m.a)(v,2),E=g[0],y=g[1];Object(n.useEffect)(function(){var e=function(){var e=Object(i.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j();case 2:t=e.sent,a=t.data,o(a);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();y(O()),e()},[]);var O=function(){console.log("get keys");var e=localStorage.getItem("pvk_phrase"),t=N.a.generateRSAKey(e,1024);return{pvk:t,pbk:N.a.publicKeyString(t)}},k=function(){var e=Object(i.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=Object(A.a)({},u)).bio=t,e.prev=2,e.next=5,d(u._id,a);case 5:o(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log(e.t0);case 11:case"end":return e.stop()}},e,null,[[2,8]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y,{onUpdateBio:k,history:t,user:u}),r.a.createElement("div",{className:"container chat"},r.a.createElement($,{history:t,location:a,setChannel:b}),r.a.createElement(D.d,null,r.a.createElement(D.b,{path:"/chat/ch/:channel",render:function(e){return r.a.createElement(U,Object.assign({},e,{user:u,channel:h,userKeys:E}))}}),r.a.createElement(D.b,{path:"/chat/list",render:function(e){return r.a.createElement(T,Object.assign({},e,{user:u,setChannel:b}))}}),r.a.createElement(D.a,{from:"/chat",to:"/chat/list"}))))});var Q=function(){return r.a.createElement("div",{className:"app"},r.a.createElement(D.d,null,r.a.createElement(D.b,{path:"/chat",component:z}),r.a.createElement(D.b,{path:"/login",component:S}),r.a.createElement(D.b,{path:"/register",component:K}),function(){var e=localStorage.getItem("pvk_phrase")&&localStorage.getItem("userToken");return Boolean(e)}()?r.a.createElement(D.a,{from:"/",to:"/chat"}):"",r.a.createElement(D.a,{from:"/",to:"/login"})),r.a.createElement(u,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(309);var V=a(50);s.a.render(r.a.createElement(V.a,null,r.a.createElement(Q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[144,1,2]]]);
//# sourceMappingURL=main.324882c2.chunk.js.map